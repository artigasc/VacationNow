<!-- navbar -->
@using Microsoft.AspNetCore.Http
@using GoTourWeb.Helpers
@{
    ViewData["Title"] = "Menu";
    GoTourWeb.Models.UserViewModel UserSession = Context.Session.Get<GoTourWeb.Models.UserViewModel>("UserSesion");
    GoTourWeb.Models.MenuViewModel vItemsMenu = GoTourWeb.Startup._vDataMenu;
    string vLanguage = ViewData["LanguageInitialDefault"].ToString();
    
}
<div class="container position-absolute fixed-top bg-w-navbar mt-4 ">
    <nav class="navbar navbar-expand-md container">
        <a class="navbar-brand" asp-area="" asp-controller="Home" asp-action="Index"><img class="img-fluid" src="~/images/logomenu.svg" width="110" alt="GoTours"></a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
            <span><i class="fas fa-bars"></i></span>
        </button>
        <div class="collapse navbar-collapse px-3" id="navbarNavDropdown">
            <ul class="navbar-nav mr-auto text-center">
                <li class="nav-item dropdown mega-menu">
                    <a class="nav-link dropdown-toggle" href="#"
                       id="navbarDropdownMenuLink"
                       role="button"
                       data-toggle="dropdown"
                       aria-haspopup="true"
                       aria-expanded="false">
                         @Language.GetTextView("Index", "navlink_1", vLanguage)

                    </a>
                    <div class="dropdown-menu dropdown-menu-left dropdown-menu-a  scrollable-menu" aria-labelledby="navbarDropdownMenuLink" style="width: @Utilities.GetWidthForMenuCities(vItemsMenu.Cities.Count())">
                        <div class="container">
                            <div class="row">
                                @{
                                    if (vItemsMenu != null && vItemsMenu.Cities != null) {
                                        int vCounter = 0;

                                        @:<div class="col-md-@Utilities.GetColForMenuCities(vItemsMenu.Cities.Count) p-0">


                                        foreach (var vItem in vItemsMenu.Cities) {
                                            if (vCounter != 0 && vCounter % 20 == 0) {
                                                @:</div>
                                                @:<div class="col-md-@Utilities.GetColForMenuCities(vItemsMenu.Cities.Count) p-0">
                                             }
                                                    <label onclick="SelectCity('@vItem.Id')" class="dropdown-item">@vItem.Name</label>

                                            vCounter++;

                                        }
                                       

                                    }

                                }
                               
                            </div>             
                            </div>
                        </div>

                      </div>
            </li>
            <li class="nav-item dropdown mega-menu">
                <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    @Language.GetTextView("Index", "navlink_2", vLanguage)
                </a>
                <div class="dropdown-menu dropdown-menu-left dropdown-menu-b" aria-labelledby="navbarDropdownMenuLink">
                    <div class="container">
                        <div class="row">
                            @{

                                if (vItemsMenu != null && vItemsMenu.Categories != null) {
                                    int vCounter = 0;

                                    @:<div class="col-lg-6 p-0">
                                        <a asp-area="" asp-controller="Tours" asp-action="Tour" class="dropdown-item">Todos los Tours</a>

                                    foreach (var vItem in vItemsMenu.Categories) {
                                        if (vCounter != 0 && vCounter % 4 == 0) {
                                            @:</div>
                                            @:<div class="col-lg-6 p-0">
                                        }
                                        <a href="@vItem.Id" class="dropdown-item">@vItem.Name</a>

                                        vCounter++;
                                    }
                                        @:</div>
                                    }
                            }




                        </div>

                        </div>
                    </div>
        </li>
    </ul>

            <ul class="navbar-nav text-center d-flex align-items-center">
                @{
                    if (vItemsMenu != null && vItemsMenu.Languages != null) {
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" id="DropdownMenuLanguaje" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <i class="fas fa-globe"></i> @ViewData["LanguageInitialDefault"]
                            </a>
                            <div class="dropdown-menu dropdown-menu-right" aria-labelledby="DropdownMenuLanguaje">
                                @{
                                    foreach (var vItem in vItemsMenu.Languages) {

                                        <label id="Languaje_@vItem.Initials" class="dropdown-item" onclick="ChangeLanguage('@vItem.Id','@vItem.Initials')">@vItem.Name</label>
                                    }
                                }

                            </div>
                        </li>
                                    }
                }
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <label id="LblName" class="m-0"> @ViewData["CurrencySymbolDefault"]</label>
                            <input id="IdCurrencyDefault" type="hidden" name="name" value="@ViewData["IdCurrencyDefault"]" />
                        </a>
                        <div id="DivCurrencies" class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdownMenuLink">
                            @{ 
                                foreach (var vItem in vItemsMenu.Currencies) {
                                    <label id="@vItem.Id" class="dropdown-item" onclick="ChangeCurrency('@vItem.Id','@vItem.Symbol')">@vItem.Name</label>
                                }
                            }
                            
                        </div>
                    </li>

        @{
            if (UserSession != null) {

                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <img class="img-fluid rounded-circle" src="@UserSession.UrlPhoto" width="35" height="35" alt=""> @UserSession.FirstName @UserSession.FirstLastName
                    </a>
                    <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdownMenuLink">
                        <a asp-area="" asp-controller="Account" asp-action="MyReservation" class="dropdown-item" ><i class="far fa-building"></i> @Language.GetTextView("Index", "account_user_1", vLanguage) </a>
                        <div class="dropdown-divider"></div>
                        <a  id="logout" class="dropdown-item" href="#"><i class="fas fa-power-off"></i>  @Language.GetTextView("Index", "account_user_2", vLanguage)</a>
                    </div>
                </li>
            } else {
                <li class="nav-item">
                    <a asp-area="" asp-controller="Account" asp-action="Register" class="nav-link btn btn-orange rounded-left">@Language.GetTextView("Index", "navlink_account_1", vLanguage)</a>
                </li>
                <li class="nav-item">
                    <a asp-area="" asp-controller="Account" asp-action="Login" class="nav-link btn btn-purple rounded-right">@Language.GetTextView("Index", "navlink_account_2", vLanguage)</a>
                </li>
            }
        }
    </ul>

        </div>
</nav>
</div>
<script>
    var vHtmlSelectCurrency = $('#DivCurrencies').html();
    var valIdCurrencyDefault = '#' + $("#IdCurrencyDefault").val();
   
    $('#' + $("#IdCurrencyDefault").val()).hide();
    $(function () {

        $('#logout').click(function () {
            Swal({
                title:  '@Language.GetMessageIn("Register", "4", vLanguage, "Title")',
                text: "",
                type: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: '@Language.GetMessageIn("Register", "4", vLanguage, "SecondTitle")',
                cancelButtonText: '@Language.GetMessageIn("Register", "4", vLanguage, "SecondText")',

            }).then(function (result) {
                if (result.value) {
                    $.ajax({
                        url: "/Account/Logout",
                        method: "POST",
                        success: function (response) {
                            if (response.content = "Ok") {
                                Swal(
                                    '@Language.GetMessageIn("Register", "5", vLanguage, "Title")',
                                    "",

                                    'success'
                                ).then(function () {
                                    window.location = '@Url.Action("Index", "Home")';
                                })

                            }
                        }
                    })


                }
            });

        })
    });

    function ChangeLanguage(valId, valInitials) {
         var model = {
             Id: valId,
             Initials: valInitials
        };

            $.ajax({
                url: "/Home/ChangeLanguage",
                method: "POST",
                data: JSON.stringify(model),
                dataType: "JSON",
                contentType: 'application/json',
                async: true,
                success: function (response) {
                    if (response.content == "1") {
                        window.location = '@Url.Action("Index", "Home")';
                        return;
                    }
                    window.location = '@Url.Action("Error", "Home")';
                },
                beforeSend: function () {
                    $("body").fadeIn(function () {
                        $(".modaldisplay").show();
                    });
                },
                complete: function () {
                    $(".modaldisplay").hide();
                },
                error: function (xhr) {
                    console.log(xhr.status + ": " + xhr.responseText);

                }
            });
    };

    function ChangeCurrency(valId, valCode) {
        var model = {
            Id: valId,
            Code: valCode
        };
        $.ajax({
            url: "/Home/ChangeCurrency",
            method: "POST",
            data: JSON.stringify(model),
            dataType: "JSON",
            contentType: 'application/json',
            async: true,
            success: function (response) {
                if (response.content == "1") {
                    $('#DivCurrencies').html(vHtmlSelectCurrency);
                    $('#LblName').text(valCode);
                    $("#" + valId).hide();
                    return;
                }

                window.location = '@Url.Action("Error", "Home")';
            },
        });

    }

   function SelectCity(valIdCity) {
        var vModel = {
            Id: valIdCity
        };
        $.ajax({
            url: "/Home/SelectCity",
            method: "POST",
            data: JSON.stringify(vModel),
            dataType: "JSON",
            contentType: 'application/json',
            async: true,
            success: function (response) {
               
                if (response.content == '1') {
                    window.location.href = '@Url.Action("Info", "City")';
                    return;
                }
                window.location.href = '@Url.Action("Error", "Home")';
            },
            beforeSend: function () {
                $("body").fadeIn(function () {
                    $(".modaldisplay").show();
                });
            },
            complete: function () {
                $(".modaldisplay").hide();
            },
            error: function (xhr) {
                console.log(xhr.status + ": " + xhr.responseText);
            }
        });
        }

</script>
